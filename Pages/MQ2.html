<!DOCTYPE HTML>
<!--
	Massively by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Afi Makes Things! - IoT-Based Smoke Detector</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/assets/css/main.css" />
		<noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
		
				<!-- Google tag (gtag.js) -->
				<script async src="https://www.googletagmanager.com/gtag/js?id=G-RPKYN5QNCM"></script>
				<script>
				window.dataLayer = window.dataLayer || [];
				function gtag(){dataLayer.push(arguments);}
				gtag('js', new Date());
		
				gtag('config', 'G-RPKYN5QNCM', {
							'page_title': 'IoT Smoke Detector',  // Custom Page Title
							'page_path': '/MQ2.html'  // Custom Page Path
									});
				</script>
	</head>
	<body class="is-preload">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" 
		integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" 
		crossorigin="anonymous" referrerpolicy="no-referrer" />
		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header1 id="header">
						<!--<a href="index.html" class="logo">Afi Makes Things!</a>-->
					</header1>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li><a href="/index.html">Home</a></li>
							<li><a href="/indexp2.html">Back</a></li>
							<li class="active"><a href="MQ2.html">IoT-Based Smoke Detector</a></li>
							<li><a class="mobile-only" href="/WhoAmI.html">About Me</a></li>
							<!-- <li><a href="elements.html">Elements Reference</a></li> -->
						</ul>
						<!-- Add this style block INSIDE HTML -->
						<style>
							/* By default, both classes are visible */
							@media (min-width: 769px) {
								.desktop-only {
									display: block !important;
								}
								.mobile-only {
									display: none !important;
								}
							}
							/* When screen size is 768px or smaller (mobile), switch the visibility */
							@media (max-width: 768px) {
								.desktop-only {
									display: none !important; /* Hide desktop tabs */
								}
								.mobile-only {
									display: block !important; /* Show mobile-only tabs */
								}
							}
						</style>
						<ul class="icons">
							<li><a href="https://linkedin.com/in/abolfazl-abbasi-b60850a2" class="fa-brands fa-linkedin fa-lg"></span></a></li>
							<li><a href="mailto:abbasi.a92@gmail.com" class="fa-solid fa-envelope fa-lg"></span></a></li>
							<li><a href="https://github.com/AfiMakesThings" class="fa-brands fa-github fa-lg"></span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<section class="post">
								<header class="major">

									<h1>IoT-Based<br /> Smoke Detector</h1>
									<p>Putting IoT into action,<br /> Smoke detector that sends email.</p>
								</header>

								<div class="container">
									<img id="toggleImage" src="/images/IoT CO2 controller IFTTT/IFTTT Wemos.png" alt="My Project Image" class="image1NoBorder" width="70%" height="auto">
								</div>
								<br /> 
								<h2>Background Story</h2>
								<p>
									I have a friend that works with large-capacity batteries and he asked me to assist him with making a control/monitor circuit 
									that can detect any abnormal charge or discharge behavior of the batteries.
									The idea behind this project is to detect any smoke/fumes generated by the batteries as well as any unusual temperature rise. <br />
									Initially, he purchased an Arduino and an MQ-2 gas sensor but he struggled to make a functional circuit then he reached out to 
									me to help him program his board, and wire up the sensor.<br />
									This project is based on Arduino Wemos D1 R2 ESP8266 and the MQ-2 sensor. We didn't have a temperature sensor at the time but 
									the hardware implementation and Arduino program is very similar to implementing an MQ-2 sensor. 
								</p>
									
									<h2>Key Features</h2>
									<p>
										This project was more about prototyping an IoT idea that could measure an analog signal and if the measured value exceeds the limit, 
										notify the user/operator by sending an email.<br />
										The main brain of the project is an Arduino WeMos with a built-in ESP8266 chip to connect to a Wi-Fi network and the internet.<br /> 
										The MQ-2 sensor connects to the Arduino board and the output of the sensor is fed into an analog input pin of the Arduino. 
										The voltage of the analog pin is measured by the internal ADC of the Arduino and scaled/mapped into an acceptable range.
										The board powers up from a micro USB port and connects to a specified Wi-Fi network in the Arduino code using the Wi-Fi chip on the WeMos.
										I used a free IoT service for development purposes and deployed the initial concept. IFTTT is the platform that I used in this project 
										to send emails when the MQ-2 sensor reads an abnormal value (IFTTT stands for "IF This Then That").<br /> 
										I created an applet in the IFTTT platform to trigger an action (Email) based on the predefined conditions. Webhook is the method 
										that IFTTT uses to connect to the devices and send and receive data. Webhook creates a unique URL to make a POST or GET web request 
										to send and receive data. <br />
										Other than the above features, using the IP of the client I could detect the location of the sender of the message. 
										This could be a very useful feature in case of having several sensors in different locations.<br /> 

										Below is a simple diagram that shows how all the components are wired up.
										</p>

										<div class="container" >
											<img id="toggleImage" src="/images/IoT CO2 controller IFTTT/Schematic.jpg" alt="My Project Image" class="image1"  height="auto">
											<style>
												.image1 {
													/*width: var(--image-size, 40%);  Default width from HTML */
													width:80%;
												}
											
												@media screen and (max-width: 768px) {
													.image1 {
														/*width: calc(var(--img-size, 40%) * 2);  Double the width for mobile */
														width:80%;
													}
												}
											</style>
											<br /> 
										</div>
										<!--	
										
										<p>
											The following image shows the rear view of the model. 
											  <div class="image main"><img src="/images/Sudoku/box arrays.jpg" alt="" /></div>
											 
											<a href="/images/Cybertruck/CT3.PNG" class="image main" style="box-shadow: 0px 0px 10px rgba(7, 7, 7, 0.3);" target="_self">
											<img src="/images/Cybertruck/CT3.PNG" alt="My Project Image"></a>
											
										</p>-->
									 <h2>Challenges and Solutions</h2>
									<p>
										The main challenge of this project was programming and being able to create communication between my computer and WeMos. 
										This was because of the old version of the board and its bootloader. I found out about Esptool which is a Python-based utility that 
										can communicate with the ESP chip and read/write into the bootloader. <br /> 
										Once I resolved the programming issue, focused on writing Arduino code and finding necessary libraries to create a client and 
										connect to the internet. <br /> 
										The below code is the function to connect to the Wi-Fi network.
									</p>
									<pre><code>void connectWiFi() {  //defining function to connect to wifi
  Serial.print("connecting to WiFi....");
  WiFi.begin(ssid, password);

  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println();
  Serial.print("WiFi connected! IP address: ");
  Serial.println(WiFi.localIP());
}
</code></pre>
										<p>
										The IFTTT documentation describes how to send and receive values to the server and take action based on the captured values. 
										According to the documentation page, a unique webhook needs to be created and any Arduino using this webhook can access my IFTTT event.
										The webhook URL needs to be hardcoded in my code and include the event name along with the unique key information. Eventually, a string needs to be created with all the required information.
										The below code is the function that creates a Webhook instance and sends measurements. 
										</p>
									<pre><code>//********************triggering IFTTT************************
void triggerIFTTT(int sense) {

  WiFiClientSecure client;  //define client to use https connection
  // Configure the secure client
  client.setInsecure(); // Use for self-signed certificates; for production use, use a valid certificate
  
  HTTPClient https;
  //WiFiClient client;  // define client to use http connection
  String url = "https://maker.ifttt.com/trigger/" + String(eventName) + "/with/key/dvUmfxxxxxxxrqTyW-L";

  String payload = "{\"value1\":\"" + String(sense) + "\"}";

  Serial.print("Sending HTTP request to: ");
  Serial.println(url);
  https.begin(client,url);
  https.addHeader("Content-Type", "application/json");

  int httpsResponseCode = https.POST(payload);

  // Print the HTTP response code for debugging
  Serial.print("HTTP Response Code: ");
  Serial.println(httpsResponseCode);

  if (httpsResponseCode == HTTP_CODE_OK) {  //if code is 200, successfull
    Serial.println("IFTTT request sent successfully.");
  } else {
    Serial.print("Error sending IFTTT request.");
    Serial.println(httpsResponseCode);
  }
  https.end();
}
</code></pre>

									<p>
									Lastly, the below code is the function that finds the location of the device based on the IP address of the client connection.
									</p>
							<pre><code>//**********************finding location*******************************
void printLocation() {
  HTTPClient https;
  //WiFiClient client;
   
   WiFiClientSecure client;  //define client to use https connection
  // Configure the secure client
  client.setInsecure(); // Use for self-signed certificates; for production use, use a valid certificate
  
  // Fetch the location data from ipinfo.io
  https.begin(client, "https://ipinfo.io/json");

  int httpsResponseCode = https.GET();

  if (httpsResponseCode == HTTP_CODE_OK) {
    // Parse the JSON response to extract the location information
    String payload = https.getString();
    Serial.println("Location: " + payload);
  } else {
    Serial.println("Error fetching location data.");
  }
  https.end();
}
</code></pre>

									<p>
										Below is the email that I received for one of the instances where the sensor value was triggered.
									</p>
									<!--
									<div>
										<div class="row gtr-50 gtr-50">
											<div class="col-10"> <a href="/images/IoT CO2 controller IFTTT/trig email.jpg" class="image fit" style="padding-inline-start: 150px;">  <img src="/images/IoT CO2 controller IFTTT/trig email.jpg" alt="" /> </a> </div>
										</div>
									</div>	
								-->
									<div class="container">
										<img id="toggleImage" src="/images/IoT CO2 controller IFTTT/trig email.jpg" alt="My Project Image" class="image1">
										<br />
										</div>

										<!--
									<div style="text-align: center;">
										<video style="box-shadow: 0px 0px 10px rgba(7, 7, 7, 0.3); height: 525px; width: 300px;" controls poster="/images/Payload/poster1.jpg">
											<source src="/images/Payload/Payload Test-music.mp4" type="video/mp4">
											Your browser does not support the video tag.
										</video>
									</div>
									
									<br />
									<div style="text-align: center;">
										<video style="box-shadow: 0px 0px 10px rgba(7, 7, 7, 0.3); " width="700" height="400"  controls poster="/images/Payload/poster2.jpg" >
											<source src="/images/Payload/Payload Test-music 2.mp4" type="video/mp4">
											Your browser does not support the video tag.
										</video>
									</div>
									<br />
									-->
									<h2>Final Words</h2>
									<p>
										This project was quite interesting for me and learned about ESP chips, Esptool, creating Wi-Fi connections, 
										POST messages and so much more. <br />
										It was an invaluable opportunity to create my first IoT project and get into web servers and IoT platforms. 
										IFTTT is quite a powerful IoT platform that provides a range of different services such as updating social media, 
										call services, and even birthday reminders. I hope that I get a chance to do more projects in IoT and make processes smarter.<br />
									</p>
									<hr />
									
									<h3>Interesting Project? Let's talk about it :)</h3>
								
									
							<form method="post" action="https://formspree.io/f/xvggqqky">
								<input type="hidden" name="Subject" id="Subject" value="IoT Smoke Detector"  />
								<div class="row gtr-uniform">
									<div class="col-4 col-12-xsmall">
										<label class="fs-label" for="Name">Name (*)</label>
										<input type="text" name="Name" id="Name" value="" style="height: 40px;" required />
									</div>
									
									<div class="col-4 col-12-xsmall">
										<label class="fs-label" for="Email">Email (*)</label>
										<input type="text" name="Email" id="Email" value="" style="height: 40px;" required />
									</div>
									<div class="col-4 col-12-xsmall">
										<label  class="fs-label" for="Company">Company</label>
										<input type="text" name="Company" id="Company" value="" style="height: 40px;" />
									</div>
									
									<div class="col-12 col-12-xsmall">
										<!-- style="padding: 10px;" class="fs-textarea" class="fs-label" <label class="fs-label" for="message">Message (*)</label> -->
										<textarea
										  style="padding: 10px;"
										  id="Message"
										  name="Message"
										  placeholder="Share your thoughts and suggestions here."
										  rows="3"
										  required
										></textarea>
									</div>
									<br />

								  <div class="actions">
									<input class="button primary" type="submit" value="Submit"  />
								  </div>

								</div>
							</form>
						</section>

				</div>
				<!-- Footer -->
					<footer id="footer">
						<!--<section>
							<form method="post" action="#">
								<div class="fields">
									<div class="field">
										<label for="name">Name</label>
										<input type="text" name="name" id="name" />
									</div>
									<div class="field">
										<label for="email">Email</label>
										<input type="text" name="email" id="email" />
									</div>
									<div class="field">
										<label for="message">Message</label>
										<textarea name="message" id="message" rows="3"></textarea>
									</div>
								</div>
								<ul class="actions">
									<li><input type="submit" value="Send Message" /></li>
								</ul>
							</form>
						</section>
						<section class="split contact">
							<section class="alt">
								<h3>Address</h3>
								<p>1234 Somewhere Road #87257<br />
								Nashville, TN 00000-0000</p>
							</section>
							<section>
								<h3>Phone</h3>
								<p><a href="#">(000) 000-0000</a></p>
							</section>
							<section>
								<h3>Email</h3>
								<p><a href="#">info@untitled.tld</a></p>
							</section>-->
							<section>
								<h3>Let's socialize</h3>
								<ul class="icons">
									<li><a href="https://linkedin.com/in/abolfazl-abbasi-b60850a2" class="fa-brands fa-linkedin fa-lg"></span></a></li>
									<li><a href="mailto:abbasi.a92@gmail.com" class="fa-solid fa-envelope fa-lg"></span></a></li>
									<li><a href="https://github.com/AfiMakesThings" class="fa-brands fa-github fa-lg"></span></a></li>
								</ul>
								<!--<ul class="icons alt">
									<li><a href="https://linkedin.com/in/abolfazl-abbasi-b60850a2" class="fa-brands fa-linkedin" style="font-size: 2em;"></a></li>
									<li><a href="mailto:abbasi.a92@gmail.com" class="fa-solid fa-envelope fa-lg" style="margin-left: 20px;"></a></li>
									<li><a href="https://github.com/AfiMakesThings" class="fa-brands fa-github" style="font-size: 2em;"></a></li>
								</ul>-->
							</section>
						</section>
					</footer>

				<!-- Copyright -->
					<div id="copyright">
						<ul><li>&copy; AfiMakesThings!</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li></ul>

					</div>

			</div>

		<!-- Scripts -->
			<script src="/assets/js/popup.js"></script>
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.scrollex.min.js"></script>
			<script src="/assets/js/jquery.scrolly.min.js"></script>
			<script src="/assets/js/browser.min.js"></script>
			<script src="/assets/js/breakpoints.min.js"></script>
			<script src="/assets/js/util.js"></script>
			<script src="/assets/js/main.js"></script>

	</body>
</html>